<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Statistiche Appuntamenti</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }
    canvas {
      max-width: 100%;
      margin-bottom: 40px;
    }
    form.filter-form {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 30px;
    }
    select, button {
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸ“Š Statistiche Appuntamenti</h2>

    <a href="{{ url_for('admin_dashboard') }}">
      <button class="big-btn">ðŸ”™ Torna alla Dashboard</button>
    </a>

    <form method="post" class="filter-form">
      <label for="month">Mese:</label>
      <select name="month" id="month">
        {% for m in range(1, 13) %}
          <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>{{ "{:02d}".format(m) }}</option>
        {% endfor %}
      </select>

      <label for="year">Anno:</label>
      <select name="year" id="year">
        {% for y in available_years %}
          <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
      </select>

      <button type="submit">Filtra</button>
    </form>

    <h3>Appuntamenti per Giorno</h3>
    <canvas id="dailyChart"></canvas>

    <h3>Appuntamenti per Mese</h3>
    <canvas id="monthlyChart"></canvas>
  </div>

  <script>
    // Dati giornalieri
    const rawLabels = {{ daily_data | map(attribute=0) | list | tojson }};
    const dailyLabels = rawLabels.map(date => new Date(date).toISOString().split('T')[0]);
    const dailyCounts = {{ daily_data | map(attribute=1) | list | tojson }};

    const ctxDay = document.getElementById('dailyChart').getContext('2d');
    new Chart(ctxDay, {
      type: 'bar',
      data: {
        labels: dailyLabels,
        datasets: [{
          label: 'Appuntamenti per Giorno',
          data: dailyCounts,
          backgroundColor: '#4e73df'
        }]
      }
    });

    // Dati mensili
    const monthlyLabels = {{ monthly_data | map(attribute=0) | list | tojson }};
    const monthlyCounts = {{ monthly_data | map(attribute=1) | list | tojson }};

    const ctxMonth = document.getElementById('monthlyChart').getContext('2d');
    new Chart(ctxMonth, {
      type: 'bar',
      data: {
        labels: monthlyLabels,
        datasets: [{
          label: 'Appuntamenti per Mese',
          data: monthlyCounts,
          backgroundColor: '#1cc88a'
        }]
      }
    });
  </script>
</body>
</html>

